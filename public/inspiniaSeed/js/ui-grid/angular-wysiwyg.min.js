"use strict";angular.module("wysiwyg.module",["colorpicker.module"]).directive("wysiwyg",["$timeout","wysiwgGui",function(t,e){function a(t,a){return e.createMenu(a.textareaMenu),{pre:n}}function n(e,a,n,i){function l(t){var e=window.getSelection().getRangeAt(0);return e&&(e.startContainer.parentNode.tagName===t.toUpperCase()||e.endContainer.parentNode.tagName===t.toUpperCase())?!0:!1}function s(){var t=window.getSelection().getRangeAt(0);if(t){var e=$(t.startContainer.parentNode).attr("style");if(!angular.isDefined(e))return!1;for(var a=e.split(";"),n=0;n<a.length;n++){var i=a[n].split(":");if("background-color"===i[0])return i[1]}return"#fff"}return"#fff"}var r=a.find("div.wysiwyg-textarea");e.$watch("disabled",function(t){angular.element("div.wysiwyg-menu").find("button").each(function(){angular.element(this).attr("disabled",t)}),angular.element("div.wysiwyg-menu").find("select").each(function(){angular.element(this).attr("disabled",t)})}),e.fonts=["Georgia","Palatino Linotype","Times New Roman","Arial","Helvetica","Arial Black","Comic Sans MS","Impact","Lucida Sans Unicode","Tahoma","Trebuchet MS","Verdana","Courier New","Lucida Console","Helvetica Neue"].sort(),e.font=e.fonts[6],e.fontSizes=[{value:"1",size:"10px"},{value:"2",size:"13px"},{value:"3",size:"16px"},{value:"4",size:"18px"},{value:"5",size:"24px"},{value:"6",size:"32px"},{value:"7",size:"48px"}],e.fontSize=e.fontSizes[1],"true"===n.enableBootstrapTitle&&void 0!==n.enableBootstrapTitle&&a.find("button[title]").tooltip({container:"body"}),r.on("input keyup paste mouseup",function(){var t=r.html();"<br>"==t&&(t=""),i.$setViewValue(t)}),e.isLink=!1,r.on("click keyup focus mouseup",function(){t(function(){e.isBold=e.cmdState("bold"),e.isUnderlined=e.cmdState("underline"),e.isStrikethrough=e.cmdState("strikethrough"),e.isItalic=e.cmdState("italic"),e.isSuperscript=l("SUP"),e.isSubscript=l("SUB"),e.isRightJustified=e.cmdState("justifyright"),e.isLeftJustified=e.cmdState("justifyleft"),e.isCenterJustified=e.cmdState("justifycenter"),e.isPre="pre"==e.cmdValue("formatblock"),e.isBlockquote="blockquote"==e.cmdValue("formatblock"),e.isOrderedList=e.cmdState("insertorderedlist"),e.isUnorderedList=e.cmdState("insertunorderedlist"),e.fonts.forEach(function(t){return e.cmdValue("fontname").indexOf(t)>-1?(e.font=t,!1):void 0}),e.fontSizes.forEach(function(t){return e.cmdValue("fontsize")===t.value?(e.fontSize=t,!1):void 0}),e.hiliteColor=s(),a.find("button.wysiwyg-hiliteColor").css("background-color",e.hiliteColor),e.fontColor=e.cmdValue("forecolor"),a.find("button.wysiwyg-fontcolor").css("color",e.fontColor),e.isLink=l("A")},10)}),i.$render=function(){r.html(i.$viewValue)},e.format=function(t,e){document.execCommand(t,!1,e)},e.cmdState=function(t){return document.queryCommandState(t)},e.cmdValue=function(t){return document.queryCommandValue(t)},e.createLink=function(){var t=prompt("Enter the link URL");t&&void 0!==t&&e.format("createlink",t)},e.insertImage=function(){var t=prompt("Enter the image URL");t&&void 0!==t&&e.format("insertimage",t)},e.setFont=function(){e.format("fontname",e.font)},e.setFontSize=function(){e.format("fontsize",e.fontSize.value)},e.setFontColor=function(){e.format("forecolor",e.fontColor)},e.setHiliteColor=function(){e.format("hiliteColor",e.hiliteColor)},e.format("enableobjectresizing",!0),e.format("styleWithCSS",!0)}return{template:'<div><style>   .wysiwyg-textarea[contentEditable="false"]{ background-color:#eee}   .wysiwyg-btn-group-margin{  margin-right:5px; }   .wysiwyg-select{ height:30px;margin-bottom:1px;}   .wysiwyg-colorpicker{ font-family: arial, sans-serif !important;font-size:16px !important; padding:2px 10px !important;}</style><div class="wysiwyg-menu"></div><div id="{{textareaId}}" ng-attr-style="resize:vertical;height:{{textareaHeight || \'80px\'}}; overflow:auto" contentEditable="{{!disabled}}" class="{{textareaClass}} wysiwyg-textarea" rows="{{textareaRows}}" name="{{textareaName}}" required="{{textareaRequired}}" placeholder="{{textareaPlaceholder}}" ng-model="value"></div></div>',restrict:"E",scope:{value:"=ngModel",textareaHeight:"@textareaHeight",textareaName:"@textareaName",textareaPlaceholder:"@textareaPlaceholder",textareaClass:"@textareaClass",textareaRequired:"@textareaRequired",textareaId:"@textareaId",textareaMenu:"@textareaMenu",disabled:"=?disabled"},replace:!0,require:"ngModel",compile:a}}]).factory("wysiwgGui",["wysiwgGuiElements",function(t){function e(t){var a;if(t.tag)a=document.createElement(t.tag);else{if(!t.text)return console.log("cannot create this element."),a=document.createElement("span");a=document.createElement("span")}if(t.text&&(a.innerText=t.text),t.classes&&(a.className=t.classes),t.html&&(a.innerHTML=t.html),t.attributes&&t.attributes.length)for(var n in t.attributes){var i=t.attributes[n];i.name&&i.value&&a.setAttribute(i.name,i.value)}if(t.data&&t.data.length)for(var l in t.data)a.appendChild(e(t.data[l]));return a}var a=[["bold","italic","underline","strikethrough","subscript","superscript"],["font"],["font-size"],["font-color","hilite-color"],["remove-format"],["ordered-list","unordered-list","outdent","indent"],["left-justify","center-justify","right-justify"],["code","quote","paragraph"],["link","image"]],n=t,i=function(){return{tag:"div",classes:"btn-group btn-group-sm wysiwyg-btn-group-margin"}},l=function(t){return n[t]||{}},s=function(t){t=angular.isDefined(t)&&""!==t?r(t):a;for(var n=document.createElement("div"),s=0;s<t.length;s++){for(var o=e(i()),u=0;u<t[s].length;u++){if("link"===t[s][u]){var c=e(l("unlink"));o.appendChild(c)}var c=e(l(t[s][u]));o.appendChild(c)}n.appendChild(o)}var f=document.createDocumentFragment(),d=document.querySelector("div.wysiwyg-menu");f.appendChild(n),d.appendChild(f)},r=function(t){var e;try{e=JSON.parse(t.replace(/'/g,'"'))}catch(a){}return e};return{createMenu:s}}]).value("wysiwgGuiElements",{bold:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Bold"},{name:"ng-click",value:"format('bold')"},{name:"ng-class",value:"{ active: isBold }"}],data:[{tag:"i",classes:"fa fa-bold"}]},italic:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Italic"},{name:"ng-click",value:"format('italic')"},{name:"ng-class",value:"{ active: isItalic }"}],data:[{tag:"i",classes:"fa fa-italic"}]},underline:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Underline"},{name:"ng-click",value:"format('underline')"},{name:"ng-class",value:"{ active: isUnderline }"}],data:[{tag:"i",classes:"fa fa-underline"}]},strikethrough:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Strikethrough"},{name:"ng-click",value:"format('strikethrough')"},{name:"ng-class",value:"{ active: isStrikethrough }"}],data:[{tag:"i",classes:"fa fa-strikethrough"}]},subscript:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Subscript"},{name:"ng-click",value:"format('subscript')"},{name:"ng-class",value:"{ active: isSubscript }"}],data:[{tag:"i",classes:"fa fa-subscript"}]},superscript:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Superscript"},{name:"ng-click",value:"format('superscript')"},{name:"ng-class",value:"{ active: isSuperscript }"}],data:[{tag:"i",classes:"fa fa-superscript"}]},"remove-format":{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Remove Formatting"},{name:"ng-click",value:"format('removeFormat')"}],data:[{tag:"i",classes:"fa fa-eraser"}]},"ordered-list":{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Ordered List"},{name:"ng-click",value:"format('insertorderedlist')"},{name:"ng-class",value:"{ active: isOrderedList }"}],data:[{tag:"i",classes:"fa fa-list-ol"}]},"unordered-list":{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Unordered List"},{name:"ng-click",value:"format('insertunorderedlist')"},{name:"ng-class",value:"{ active: isUnorderedList }"}],data:[{tag:"i",classes:"fa fa-list-ul"}]},outdent:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Outdent"},{name:"ng-click",value:"format('outdent')"}],data:[{tag:"i",classes:"fa fa-outdent"}]},indent:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Indent"},{name:"ng-click",value:"format('indent')"}],data:[{tag:"i",classes:"fa fa-indent"}]},"left-justify":{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Left Justify"},{name:"ng-click",value:"format('justifyleft')"},{name:"ng-class",value:"{ active: isLeftJustified }"}],data:[{tag:"i",classes:"fa fa-align-left"}]},"center-justify":{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Center Justify"},{name:"ng-click",value:"format('justifycenter')"},{name:"ng-class",value:"{ active: isCenterJustified }"}],data:[{tag:"i",classes:"fa fa-align-center"}]},"right-justify":{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Right Justify"},{name:"ng-click",value:"format('justifyright')"},{name:"ng-class",value:"{ active: isRightJustified }"}],data:[{tag:"i",classes:"fa fa-align-right"}]},code:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Code"},{name:"ng-click",value:"format('formatblock', 'pre')"},{name:"ng-class",value:"{ active: isPre }"}],data:[{tag:"i",classes:"fa fa-code"}]},quote:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Quote"},{name:"ng-click",value:"format('formatblock', 'blockquote')"},{name:"ng-class",value:"{ active: isBlockquote }"}],data:[{tag:"i",classes:"fa fa-quote-right"}]},paragraph:{tag:"button",classes:"btn btn-default",text:"P",attributes:[{name:"title",value:"Paragragh"},{name:"ng-click",value:"format('insertParagraph')"},{name:"ng-class",value:"{ active: isParagraph }"}]},image:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Image"},{name:"ng-click",value:"insertImage()"}],data:[{tag:"i",classes:"fa fa-picture-o"}]},"font-color":{tag:"button",classes:"btn btn-default wysiwyg-colorpicker wysiwyg-fontcolor",text:"A",attributes:[{name:"title",value:"Font Color"},{name:"colorpicker",value:"rgba"},{name:"colorpicker-position",value:"top"},{name:"ng-model",value:"fontColor"},{name:"ng-change",value:"setFontColor()"}]},"hilite-color":{tag:"button",classes:"btn btn-default wysiwyg-colorpicker wysiwyg-fontcolor",text:"H",attributes:[{name:"title",value:"Hilite Color"},{name:"colorpicker",value:"rgba"},{name:"colorpicker-position",value:"top"},{name:"ng-model",value:"hiliteColor"},{name:"ng-change",value:"setHiliteColor()"}]},font:{tag:"select",classes:"form-control wysiwyg-select",attributes:[{name:"title",value:"Image"},{name:"ng-model",value:"font"},{name:"ng-options",value:"f for f in fonts"},{name:"ng-change",value:"setFont()"}]},"font-size":{tag:"select",classes:"form-control wysiwyg-select",attributes:[{name:"title",value:"Image"},{name:"ng-model",value:"fontSize"},{name:"ng-options",value:"f.size for f in fontSizes"},{name:"ng-change",value:"setFontSize()"}]},link:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Link"},{name:"ng-click",value:"createLink()"},{name:"ng-show",value:"!isLink"}],data:[{tag:"i",classes:"fa fa-link"}]},unlink:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Unlink"},{name:"ng-click",value:"format('unlink')"},{name:"ng-show",value:"isLink"}],data:[{tag:"i",classes:"fa fa-unlink"}]}});